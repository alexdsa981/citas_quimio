<div th:fragment="modalFichaPaciente" xmlns:th="http://www.thymeleaf.org">
    <div class="modal fade" id="modalFichaPaciente" tabindex="-1" aria-labelledby="modalFichaPacienteLabel"
         aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">

                <div class="modal-header d-flex justify-content-between align-items-center">
                    <h5 class="modal-title mb-0" id="modalFichaPacienteLabel">Ficha del Paciente</h5>

                    <div class="d-flex align-items-center gap-3">
                        <div id="info-cita" class="small text-end"></div>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>

                </div>

                <div class="modal-body">
                    <!-- Nav Tabs -->
                    <ul class="nav nav-tabs" id="fichaTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="cita-tab" data-bs-toggle="tab"
                                    data-bs-target="#citaFicha" type="button" role="tab">Cita
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="signos-vitales-tab" data-bs-toggle="tab"
                                    data-bs-target="#signos-vitalesFicha" type="button" role="tab">Signos Vitales
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="detalle-quimioterapia-tab" data-bs-toggle="tab"
                                    data-bs-target="#detalleQuimioterapiaFicha" type="button" role="tab">Detalle
                                Quimioterapia
                            </button>
                        </li>

                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="cie10-tab" data-bs-toggle="tab" data-bs-target="#cie10Ficha"
                                    type="button" role="tab">Diagnóstico
                            </button>
                        </li>

                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content mt-3">


                        <div id="citaFicha" class="tab-pane fade show active" role="tabpanel"
                             aria-labelledby="cita-tab">
                            <div class="row g-4">

                                <!-- Columna Paciente -->
                                <div class="col-md-6">
                                    <!-- Datos del Paciente -->
                                    <div class="card border-0 shadow-sm rounded-4">
                                        <div class="card-header bg-light text-secondary fw-bold border-bottom border-2 border-primary">
                                            <i class="bi bi-person-vcard-fill me-2"></i>Datos del Paciente
                                        </div>
                                        <div class="card-body">
                                            <p><strong>Nombre:</strong> <span id="nombrePacienteFicha"></span></p>
                                            <p><strong>Tipo Documento:</strong> <span
                                                    id="tipoDocumentoPacienteFicha"></span></p>
                                            <p><strong>Número Documento:</strong> <span
                                                    id="numeroDocumentoPacienteFicha"></span></p>
                                            <p><strong>Edad:</strong> <span id="edadPacienteFicha"></span> años (<span
                                                    id="fechaNacimientoPacienteFicha"></span>)</p>
                                            <p><strong>Sexo:</strong> <span id="sexoPacienteFicha"></span></p>
                                            <p><strong>Celular:</strong> <span id="celularPacienteFicha"></span></p>
                                            <p><strong>Teléfono:</strong> <span id="telefonoPacienteFicha"></span></p>
                                        </div>
                                    </div>

                                    <!-- Otros -->
                                    <div class="card border-0 shadow-sm rounded-4 mt-3">
                                        <div class="card-header bg-light text-secondary fw-bold border-bottom border-2 border-secondary">
                                            <i class="bi bi-briefcase-medical-fill me-2"></i>Otros
                                        </div>
                                        <div class="card-body">
                                            <p><strong>Aseguradora:</strong> <span id="aseguradoraCitaFicha"></span></p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Columna Cita + Atención -->
                                <div class="col-md-6">
                                    <!-- Datos de la Cita -->
                                    <div class="card border-0 shadow-sm rounded-4">
                                        <div class="card-header bg-light text-secondary fw-bold border-bottom border-2 border-success">
                                            <i class="bi bi-calendar-check-fill me-2"></i>Datos de la Cita
                                        </div>
                                        <div class="card-body">
                                            <p><strong>Registrado Por:</strong> <span id="usuarioRegistroCita"></span> |
                                                <span id="fechaRegistroCita"></span></p>
                                            <p><strong>Fecha Programada:</strong> <span id="fechaCitaFicha"></span> |
                                                <span id="horaCitaFicha"></span> - <span id="horaCitaFinFicha"></span>
                                            </p>
                                            <p><strong>Médico:</strong> <span id="medicoCitaFicha"></span></p>
                                            <p><strong>Estado:</strong> <span id="estadoCitaFicha"></span></p>

                                            <div id="reprogramacionCampos" style="display: none;">
                                                <p><strong>Motivo de Reprogramación:</strong> <span
                                                        id="motivoReprogramacionCita"></span></p>
                                                <p><strong>Descripción de Reprogramación:</strong> <span
                                                        id="descripcionReprogramacionCita"></span></p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Atención de Quimioterapia -->
                                    <div class="card border-0 shadow-sm rounded-4 mt-3">
                                        <div class="card-header bg-light text-secondary fw-bold border-bottom border-2 border-info">
                                            <i class="bi bi-capsule-pill me-2"></i>Atención de Quimioterapia
                                        </div>
                                        <div class="card-body">
                                            <p><strong>Enfermera:</strong> <span id="enfermeraFichaTexto"></span></p>
                                            <p><strong>Médico:</strong> <span id="medicoFichaTexto"></span></p>
                                            <p><strong>Cubículo:</strong> <span id="cubiculoFichaTexto"></span></p>
                                            <p><strong>Hora Inicio:</strong> <span id="horaInicioFichaTexto"></span></p>
                                            <p><strong>Hora Fin:</strong> <span id="horaFinFichaTexto"></span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="tab-pane fade" id="signos-vitalesFicha" role="tabpanel"
                             aria-labelledby="signos-vitales-tab">
                            <div class="card shadow-sm rounded-4 border-0">
                                <div class="card-header bg-light text-dark fw-bold border-bottom">
                                    <i class="bi bi-heart-pulse-fill text-danger me-2"></i>Signos Vitales y Datos
                                    Antropométricos
                                </div>
                                <div class="card-body row g-3 form-disabled"
                                     id="datosModificablesFuncionesVitalesFicha">

                                    <!-- Signos Vitales -->
                                    <div class="col-md-3">
                                        <label class="form-label">Presión Arterial <span style="color:red;">*</span>
                                            <small>(mmHg)</small></label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" placeholder="Sistólica"
                                                   id="presionSistolicaFicha">
                                            <span class="input-group-text">/</span>
                                            <input type="number" class="form-control" placeholder="Diastólica"
                                                   id="presionDiastolicaFicha">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Frecuencia Respiratoria <span
                                                style="color:red;">*</span> <small>(x min)</small></label>
                                        <input type="number" class="form-control" placeholder="--"
                                               id="frecuenciaRespiratoriaFicha">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Frecuencia Cardíaca <span style="color:red;">*</span>
                                            <small>(x min)</small></label>
                                        <input type="number" class="form-control" placeholder="--"
                                               id="frecuenciaCardiacaFicha">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Temperatura <span style="color:red;">*</span> <small>(°C)</small></label>
                                        <input type="number" step="0.1" class="form-control" placeholder="--"
                                               id="temperaturaFicha">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Saturación <span style="color:red;">*</span> <small>(%)</small></label>
                                        <input type="number" class="form-control" placeholder="--"
                                               id="saturacionOxigenoFicha">
                                    </div>

                                    <!-- Datos Antropométricos -->
                                    <div class="col-md-3">
                                        <label class="form-label">Peso <small>(kg)</small></label>
                                        <input type="number" step="0.1" class="form-control" placeholder="--"
                                               id="pesoFicha">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Talla <small>(cm)</small></label>
                                        <input type="number" class="form-control" placeholder="--" id="tallaFicha">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Sup. Corporal <small>(m²)</small></label>
                                        <input type="text" class="form-control" id="superficieCorporalFicha" readonly
                                               style="background-color: #e9ecef; cursor: not-allowed;"
                                               placeholder="Formula de Mosteller">
                                    </div>

                                    <!-- Botones -->
                                    <div class="mt-4 d-flex justify-content-end gap-2">
                                        <button type="button" class="btn btn-outline-primary bloqueable-fecha-pasada"
                                                id="btnModificarSignosVitalesFicha"
                                                onclick="habilitarEdicionSignosVitalesFicha()">Modificar
                                        </button>
                                        <button type="button" class="btn btn-success bloqueable-fecha-pasada"
                                                id="btnGuardarSignosVitalesFicha"
                                                onclick="guardarSignosVitalesFicha()">Guardar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="tab-pane fade" id="detalleQuimioterapiaFicha" role="tabpanel"
                             aria-labelledby="detalle-quimioterapia-tab">
                            <div class="card shadow-sm border-0 rounded-4">
                                <div class="card-header bg-light fw-bold text-dark border-bottom">
                                    <i class="bi bi-journal-medical me-2 text-info"></i>Detalle Clínico de Quimioterapia
                                </div>
                                <div class="card-body row g-3 form-disabled"
                                     id="datosModificablesDetalleQuimioterapiaFicha">

                                    <!-- Medicinas y Observaciones -->
                                    <div class="col-md-6">
                                        <label for="medicinasFicha" class="form-label">Medicinas</label>
                                        <textarea id="medicinasFicha" name="medicinas" class="form-control" rows="9"
                                                  placeholder=""></textarea>
                                    </div>
                                    <div class="col-md-6 d-flex flex-column justify-content-center">
                                        <div class="col-12">
                                            <small>
                                                <label for="observacionesFicha" class="form-label">Observaciones</label>
                                            </small>
                                            <textarea id="observacionesFicha" name="observaciones" class="form-control"
                                                      rows="3" placeholder=""></textarea>
                                        </div>

                                        <div class="col-12 mt-3">
                                            <small>
                                                <label for="tratamientoFicha" class="form-label">Tratamiento</label>
                                            </small>
                                            <textarea id="tratamientoFicha" name="tratamiento" class="form-control"
                                                      rows="3" placeholder=""></textarea>
                                        </div>
                                    </div>


                                </div>

                                <div class="card-footer bg-white border-top mt-3 d-flex justify-content-end gap-2">
                                    <button type="button" class="btn btn-outline-primary bloqueable-fecha-pasada"
                                            id="btnModificarDetalleQuimioterapiaFicha"
                                            onclick="habilitarEdicionDetalleQuimioterapiaFicha()">Modificar
                                    </button>
                                    <button type="button" class="btn btn-success bloqueable-fecha-pasada"
                                            id="btnGuardarDetalleQuimioterapiaFicha"
                                            onclick="guardarDetalleQuimioterapiaFicha()" disabled>Guardar
                                    </button>
                                </div>
                            </div>
                        </div>


                        <div class="tab-pane fade" id="cie10Ficha" role="tabpanel" aria-labelledby="cie10-tab">
                            <div class="card shadow-sm border-0 rounded-4">
                                <div class="card-header bg-warning-subtle text-dark fw-bold">
                                    <i class="bi bi-clipboard-pulse me-2 text-warning"></i> Diagnóstico CIE10
                                </div>

                                <div class="card-body">
                                    <!-- Mensaje si no hay CIE -->
                                    <div id="mensajeCieNoDiagnostico" class="text-muted mb-3">
                                        <i class="bi bi-info-circle-fill"></i> No se han registrado diagnósticos CIE10
                                        aún.
                                    </div>

                                    <!-- Campo de búsqueda oculto por defecto -->
                                    <div class="row g-3 mb-3" id="busquedaCieContainer" style="display: none;">
                                        <div class="col-md-12">
                                            <label class="form-label">Buscar CIE10</label>
                                            <div class="input-group">
                                                <span class="form-control" style="background-color: #e9ecef;">
                                                    Haz clic en Buscar para seleccionar un CIE10
                                                </span>
                                                <button id="btnBuscarCie"
                                                        class="btn btn-outline-primary bloqueable-fecha-pasada"
                                                        type="button" onclick="abrirModalCie()" disabled>Buscar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="mensajeFechaCie" class="text-muted mb-2 d-none"></div>


                                    <!-- Lista de CIE10 -->
                                    <div class="col-md-12">
                                        <label class="form-label">Lista de CIE10 diagnosticados:</label>
                                        <ul id="lista-cie-seleccionados" class="list-group mt-2"></ul>
                                    </div>
                                </div>

                                <div class="card-footer bg-white d-flex justify-content-end gap-2">
                                    <button type="button" class="btn btn-outline-info bloqueable-fecha-pasada"
                                            id="btnModificarCieFicha"
                                            onclick="habilitarModificacionCieFicha() ">Modificar
                                    </button>
                                    <button id="btnGuardarCie" class="btn btn-success bloqueable-fecha-pasada"
                                            type="button"
                                            onclick="guardarCieSeleccionados()" disabled>Guardar CIE10
                                    </button>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>
    </div>
</div>